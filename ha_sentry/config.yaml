name: Home Assistant Sentry
version: "2.0.06"
slug: ha_sentry
description: Daily review of add-on and HACS updates with AI-powered conflict detection
arch:
  - armhf
  - armv7
  - aarch64
  - amd64
  - i386
init: false
hassio_api: true
hassio_role: manager
homeassistant_api: true
ingress: true
ingress_port: 8099
panel_icon: mdi:family-tree
panel_title: Sentry
panel_admin: true
startup: services
boot: auto
auto_update: true
ports:
  8099/tcp: 8099
ports_description:
  8099/tcp: Web interface

# Map Home Assistant directories for dependency graph building
# This gives the add-on read-only access to integration manifests
map:
  - config:ro
  - share:ro
  - homeassistant_config:ro
  
# ==================================================================================
# CONFIGURATION PARAMETER GUIDE
# ==================================================================================
#
# Below are detailed descriptions of each configuration parameter.
# Adjust these settings based on your needs and setup.
#
# AI CONFIGURATION
# ----------------
# ai_enabled: Enable AI-powered analysis for updates
#   - true: Use AI to analyze updates (requires ai_provider, ai_endpoint, ai_model)
#   - false: Use advanced heuristic analysis without AI (still provides deep analysis)
#   WHEN TO USE: Enable if you want the most comprehensive analysis. Disable if you
#                don't have an AI service available or prefer local heuristic analysis.
#
# ai_provider: Which AI service to use
#   - "openai": OpenAI cloud service (requires API key)
#   - "ollama": Local Ollama instance (free, runs locally)
#   - "lmstudio": Local LMStudio instance (free, runs locally)
#   - "openwebui": OpenWebUI instance (local or remote)
#   WHEN TO USE: Choose based on your setup. Use "ollama" or "lmstudio" for complete
#                privacy and no cloud dependencies.
#
# ai_endpoint: URL where your AI service is accessible
#   - For Ollama: "http://localhost:11434" (or your Ollama host)
#   - For LMStudio: "http://localhost:1234" (or your LMStudio host)
#   - For OpenAI: "https://api.openai.com/v1"
#   - For OpenWebUI: "http://your-openwebui-host:8080"
#   WHEN TO USE: Change from default if your AI service runs on a different host/port.
#
# ai_model: Which AI model to use
#   - For Ollama: "llama2", "mistral", "codellama", etc.
#   - For LMStudio: Whatever model you've loaded
#   - For OpenAI: "gpt-3.5-turbo", "gpt-4", etc.
#   WHEN TO USE: Choose a model that's available in your AI service.
#
# api_key: API key for authentication (if required)
#   - Required for OpenAI
#   - Not required for Ollama or LMStudio
#   - May be required for OpenWebUI depending on your setup
#   WHEN TO USE: Only when your AI provider requires authentication.
#
# SCHEDULING CONFIGURATION
# ------------------------
# check_schedule: Time of day to run the daily check
#   - Format: "HH:MM" in 24-hour time (e.g., "02:00" for 2 AM, "14:30" for 2:30 PM)
#   - Default: "02:00" (2 AM)
#   WHEN TO USE: Set to a time when your system is typically idle and you want the
#                check to run. Early morning is recommended to have results ready
#                when you check in the morning.
#
# UPDATE MONITORING CONFIGURATION
# --------------------------------
# check_all_updates: Monitor all update types (Core, Supervisor, OS, Add-ons, Integrations)
#   - true: Check all system updates (RECOMMENDED - most comprehensive)
#   - false: Use legacy mode with check_addons and check_hacs settings
#   WHEN TO USE: Keep true for complete update monitoring. Set false only if you want
#                granular control using check_addons and check_hacs.
#
# check_addons: Monitor add-on updates (legacy parameter)
#   - true: Check add-on updates
#   - false: Skip add-on updates
#   WHEN TO USE: Only used when check_all_updates is false. Keep true unless you
#                specifically want to monitor only HACS integrations.
#
# check_hacs: Monitor HACS integration updates (legacy parameter)
#   - true: Check HACS integration updates
#   - false: Skip HACS updates
#   WHEN TO USE: Only used when check_all_updates is false. Keep true unless you
#                specifically want to monitor only add-ons.
#
# DASHBOARD CONFIGURATION
# -----------------------
# create_dashboard_entities: Create sensor entities in Home Assistant
#   - true: Creates 6 sensor entities you can add to dashboards (RECOMMENDED)
#   - false: No sensor entities created (you'll only get notifications)
#   WHEN TO USE: Enable if you want to see update status in dashboards. Disable if
#                you only want notifications and don't need dashboard integration.
#
# ANALYSIS CONFIGURATION
# ----------------------
# safety_threshold: Confidence threshold for marking updates as safe
#   - Range: 0.0 to 1.0
#   - 0.9-1.0: Very conservative (only approve very confident analyses)
#   - 0.7: Balanced (recommended for most users)
#   - 0.5-0.6: Aggressive (accept more uncertain analyses)
#   WHEN TO USE: Lower if you're comfortable with some uncertainty. Raise if you want
#                to be very cautious and only approve highly confident analyses.
#
# DEPENDENCY ANALYSIS CONFIGURATION
# ----------------------------------
# enable_dependency_graph: Build and analyze dependency relationships
#   - true: Parse integration manifests and build dependency graph (RECOMMENDED)
#   - false: Skip dependency graph analysis
#   WHEN TO USE: Enable for enhanced analysis of shared dependencies and conflicts.
#                Disable if you have issues with integration path scanning or don't
#                need dependency conflict detection.
#
# custom_integration_paths: Custom paths to scan for integrations
#   - Default: [] (uses built-in default paths)
#   - Example: ["/config/custom_components", "/share/integrations"]
#   WHEN TO USE: Only if default paths don't work in your environment. The add-on
#                will suggest paths in the logs if defaults fail.
#
# WEB UI CONFIGURATION
# --------------------
# enable_web_ui: Enable web-based dependency visualization interface
#   - true: Start web server for dependency tree visualization (RECOMMENDED)
#   - false: Disable web UI
#   WHEN TO USE: Enable to access the interactive dependency visualization via the
#                Sentry sidebar panel. Requires enable_dependency_graph to be true.
#
# port: Web interface port for DIRECT browser access
#   - Default: 8099
#   - Range: 1024-65535
#   WHEN TO USE: Change if port 8099 is already in use on your system
#
#   IMPORTANT: Dual-Port Configuration
#   The Web UI supports two access methods:
#
#   1. Home Assistant Sidebar Panel (Ingress - Always Port 8099)
#      • Uses HA's ingress proxy system (internal routing)
#      • Always uses port 8099 internally (required by HA Supervisor)
#      • Works regardless of your "port" setting
#      • Access: Look for "Sentry" panel in HA sidebar
#
#   2. Direct Browser Access (Custom Port - User Configurable)
#      • Direct HTTP access to the web server
#      • Uses the port number you configure here
#      • Access: http://homeassistant:PORT
#
#   EXAMPLES:
#   • port: 8099
#     → Sidebar panel works (ingress on 8099)
#     → Direct access: http://homeassistant:8099
#     → Single web server instance (both use same port)
#
#   • port: 8098
#     → Sidebar panel still works (ingress on 8099)
#     → Direct access: http://homeassistant:8098
#     → Two web server instances (one for ingress, one for direct access)
#
#   WHY DUAL PORTS?
#   • Ingress requires port 8099 (HA Supervisor requirement)
#   • Custom port allows direct access when 8099 conflicts with other services
#   • Both can run simultaneously without issues
#
# REPORTING CONFIGURATION
# -----------------------
# save_reports: Save machine-readable JSON reports to disk
#   - true: Save detailed reports to /data/reports/ (RECOMMENDED)
#   - false: Don't save reports
#   WHEN TO USE: Enable for debugging, external analysis, or keeping historical records.
#                Reports include full analysis details in JSON format.
#
# LOGGING CONFIGURATION
# ---------------------
# log_level: Logging verbosity
#   - "minimal": Only errors (production use with minimal logging)
#   - "standard": Info and errors (RECOMMENDED for normal use)
#   - "maximal": Debug, info, and errors (troubleshooting and development)
#   WHEN TO USE: Use "standard" normally. Use "maximal" when troubleshooting issues.
#                Use "minimal" if you want the quietest operation.
#
# obfuscate_logs: Obfuscate sensitive data in log files (RECOMMENDED)
#   - true: Obfuscate IP addresses, API keys, tokens, and passwords in logs
#   - false: Log all data in plain text (not recommended - use only for debugging)
#   WHEN TO USE: Keep enabled (true) for privacy and security. Only disable for
#                specific debugging scenarios where you need to see full data.
#   WHAT IS OBFUSCATED:
#     - IP addresses: 192.168.1.100 becomes 192.***.***.100
#     - API keys/tokens: api_key=secret123456 becomes api_key=sec***456
#     - Authorization headers: Bearer token123 becomes Bearer tok***23
#     - URL parameters: ?token=secret becomes ?token=sec***et
#
# LOG MONITORING CONFIGURATION
# ----------------------------
# monitor_logs_after_update: Monitor Home Assistant logs for errors after updates
#   - true: Check logs after components are updated and report unexpected failures
#   - false: Don't monitor logs (default)
#   WHEN TO USE: Enable if you want to be notified about new error messages that
#                appear after updates. This helps catch issues early before they
#                impact your system. In heuristics mode, changes are listed. In AI
#                mode, errors are analyzed and summarized.
#
# log_check_lookback_hours: How many hours of logs to analyze
#   - Default: 24 (last 24 hours)
#   - Range: 1-168 (1 hour to 7 days)
#   WHEN TO USE: Adjust based on your update frequency. If you update weekly,
#                consider 48-72 hours. For daily updates, 24 hours is sufficient.
#
# INSTALLATION REVIEW CONFIGURATION
# ----------------------------------
# enable_installation_review: Enable AI-powered review of your HA installation
#   - true: Periodically review your installation and suggest improvements
#   - false: Don't perform installation reviews (default)
#   WHEN TO USE: Enable if you want AI to analyze your Home Assistant setup and
#                suggest optimizations, best practices, and potential improvements.
#                This is a read-only analysis that provides recommendations only.
#
# installation_review_schedule: When to run installation reviews
#   - "weekly": Run once per week (recommended)
#   - "monthly": Run once per month
#   - "manual": Only run when manually triggered (future feature)
#   WHEN TO USE: Choose "weekly" for regular insights, "monthly" for less frequent
#                reviews. This is separate from daily update checks.
#
# installation_review_scope: What aspects to review
#   - "full": Review integrations, devices, automations, helpers, and dashboards (recommended)
#   - "integrations": Only review integrations and their configuration
#   - "automations": Only review automations and scripts
#   WHEN TO USE: Use "full" for comprehensive analysis. Use specific scopes if you
#                only want targeted advice in certain areas.
#
# ==================================================================================

options:
  ai_enabled: true
  ai_provider: "openai"
  ai_endpoint: "http://localhost:11434"
  ai_model: "gpt-3.5-turbo"
  api_key: ""
  check_schedule: "02:00"
  create_dashboard_entities: true
  check_all_updates: true
  check_addons: true
  check_hacs: true
  safety_threshold: 0.7
  log_level: "standard"
  obfuscate_logs: true
  enable_dependency_graph: true
  save_reports: true
  enable_web_ui: true
  port: 8099
  custom_integration_paths: []
  monitor_logs_after_update: false
  log_check_lookback_hours: 24
  enable_installation_review: false
  installation_review_schedule: "weekly"
  installation_review_scope: "full"
schema:
  ai_enabled: bool
  ai_provider: list(openai|ollama|lmstudio|openwebui)
  ai_endpoint: str
  ai_model: str
  api_key: password?
  check_schedule: str
  create_dashboard_entities: bool
  check_all_updates: bool
  check_addons: bool
  check_hacs: bool
  safety_threshold: float(0.0,1.0)
  log_level: list(minimal|standard|maximal)
  obfuscate_logs: bool
  enable_dependency_graph: bool
  save_reports: bool
  enable_web_ui: bool
  port: port
  custom_integration_paths:
    - str?
  monitor_logs_after_update: bool
  log_check_lookback_hours: int(1,168)
  enable_installation_review: bool
  installation_review_schedule: list(weekly|monthly|manual)
  installation_review_scope: list(full|integrations|automations)
